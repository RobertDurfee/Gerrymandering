doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(name='viewport', content='initial-scale=1, maximum-scale=1, user-scalable=no')

    title #{title}
    
    style(type='text/css').
      html,
      body,
      #view {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

    link(rel='stylesheet', href='https://js.arcgis.com/4.18/esri/themes/light/main.css')
    script(src='https://js.arcgis.com/4.18/')

    script(type='text/javascript').
      require(['esri/config', 'esri/Map', 'esri/views/MapView', 'esri/layers/GeoJSONLayer'], (config, Map, MapView, GeoJSONLayer) => {
        config.apiKey = 'AAPKe1f7550caecd47ba81486e59e249ed10fGrs0zUkJXthtgBnHTifoQpq0L3_1QIMHayYYq7b0DuGM7pH9pXhBaEH-UXAHjYV'

        const base = new GeoJSONLayer({
          url: 'https://api.gm.durfee.io#{baseURI}',
          popupTemplate: {
            title: 'base',
          },
          renderer: {
            type: 'simple',
            symbol: {
              type: 'simple-fill',
              outline: {
                width: '0px',
              },
            },
            visualVariables: [{
              type: 'color',
              field: 'competitiveness',
              stops: [{
                value: -1.0,
                color: '#D81C28',
              }, {
                value: 0.0,
                color: '#FFFFFF',
              }, {
                value: 1.0,
                color: '#019BD8',
              }],
            }],
          },
        })

        const overlay = new GeoJSONLayer({
          url: 'https://api.gm.durfee.io#{overlayURI}',
          popupTemplate: {
            title: 'overlay',
          },
          renderer: {
            type: 'simple',
            symbol: {
              type: 'simple-fill',
              color: [255, 255, 255, 0.0],
              outline: {
                color: [100, 100, 100, 0.2],
                width: '1px',
              },
            },
          },
        })

        const map = new Map({
          basemap: 'arcgis-light-gray',
          layers: [base, overlay],
        })

        const view = new MapView({
          map: map,
          center: [-89.5, 44.5],
          zoom: 6,
          container: 'view',
        })
      })

  body
    div(id='view')
